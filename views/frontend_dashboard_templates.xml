<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Frontend Dashboard: Upcoming Matches Per Day -->
    <template id="tournament_frontend_dashboard_template" name="Tournament Frontend Dashboard" page="True">
        <t t-call="website.layout">
            <div class="container mt32 mb32">
                <h2>Upcoming Matches Per Day</h2>
                <canvas id="matchesPerDayChart" width="600" height="300"></canvas>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script type="text/javascript">
                var ctx = document.getElementById('matchesPerDayChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: %s,
                        datasets: [{
                            label: 'Matches',
                            data: %s,
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            </script>
            ''' %% (days, counts)"/>
        </t>
    </template>

    <!-- Interactive Bracket View -->
    <template id="tournament_bracket_template" name="Tournament Bracket" page="True">
        <t t-call="website.layout">
            <div class="container mt32 mb32">
                <h2>Bracket for <t t-esc="tournament.name"/></h2>
                <div id="bracket"></div>
            </div>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-bracket@0.11.1/dist/jquery.bracket.min.css"/>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/jquery-bracket@0.11.1/dist/jquery.bracket.min.js"></script>
            <script type="text/javascript">
                var bracketData = <t t-raw="bracket_data"/>;
                // For simplicity, only show the first category's bracket
                var catNames = Object.keys(bracketData);
                if (catNames.length > 0) {
                    var rounds = bracketData[catNames[0]];
                    var teams = [];
                    var results = [];
                    var firstRound = rounds[Object.keys(rounds)[0]];
                    for (var i = 0; i < firstRound.length; i++) {
                        teams.push([firstRound[i].team1, firstRound[i].team2]);
                    }
                    for (var r = 0; r < Object.keys(rounds).length; r++) {
                        var round = rounds[Object.keys(rounds)[r]];
                        var roundResults = [];
                        for (var m = 0; m < round.length; m++) {
                            if (round[m].score1 !== null && round[m].score2 !== null) {
                                roundResults.push([round[m].score1, round[m].score2]);
                            } else {
                                roundResults.push([null, null]);
                            }
                        }
                        results.push(roundResults);
                    }
                    $('#bracket').bracket({
                        init: {
                            teams: teams,
                            results: results
                        }
                    });
                } else {
                    $('#bracket').html('<p>No bracket data available.</p>');
                }
            </script>
        </t>
    </template>

    <!-- Club Standings Dashboard (Chart.js) -->
    <template id="tournament_dashboard_template" name="Tournament Dashboard" page="True">
        <t t-call="website.layout">
            <div class="container mt32 mb32">
                <h2>Tournament Dashboard: <t t-esc="tournament.name"/></h2>
                <canvas id="clubPointsChart" width="600" height="300"></canvas>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script type="text/javascript">
                var ctx = document.getElementById('clubPointsChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: <t t-raw="clubs"/>,
                        datasets: [{
                            label: 'Points',
                            data: <t t-raw="points"/>,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            </script>
        </t>
    </template>
</odoo>
